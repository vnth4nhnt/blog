---
import Layout from "../layouts/Layout.astro";
import { url } from "../utils/url-utils";
import { Icon } from "astro-icon/components";
import I18nKey from "../i18n/i18nKey";
import { i18n, SUPPORTED_LOCALES, DEFAULT_LOCALE } from "../i18n/translation";

const notFoundTitle = i18n(I18nKey.notFoundTitle);
const backToHome = i18n(I18nKey.backToHome);

// Generate translations for client-side language detection
const translations = Object.fromEntries(
	SUPPORTED_LOCALES.map((lang) => [
		lang,
		{
			notFoundTitle: i18n(I18nKey.notFoundTitle, lang),
			backToHome: i18n(I18nKey.backToHome, lang),
		},
	])
);
---

<Layout title={notFoundTitle}>
	<div class="min-h-screen flex items-center justify-center px-6">
		<div class="rounded-[var(--radius-large)] overflow-hidden relative w-full max-w-[40rem] h-[20rem]">
			<div class="card-base z-10 px-9 py-6 relative w-full text-black/75 dark:text-white/75">
				<div class="flex items-center gap-4">
					<h1 class="text-[5rem] font-bold">404</h1>
					<p id="not-found-title" class="text-[2rem]">{notFoundTitle}</p>
				</div>
				<a id="back-home-link" href={url("/")} class:list={["font-bold overflow-hidden active:scale-95"]}>
					<div class="overflow-hidden transition overflow-ellipsis whitespace-nowrap text-black/75 dark:text-white/75">
						<div class="btn-plain transition max-w-fit rounded-2xl h-[3.75rem] px-4 flex items-center justify-start gap-2">
							<span id="back-home-text">{backToHome}</span>
							<Icon name="material-symbols:chevron-right-rounded" class="text-[1.75rem]" />
						</div>
					</div>
				</a>
			</div>
		</div>
	</div>
</Layout>

<script is:inline define:vars={{ translations, SUPPORTED_LOCALES, DEFAULT_LOCALE }}>
	const pathParts = window.location.pathname.split('/').filter(Boolean);
	let detectedLang = DEFAULT_LOCALE;
	
	if (pathParts.length > 0 && SUPPORTED_LOCALES.includes(pathParts[0])) {
		detectedLang = pathParts[0];
	}
	
	// Update home link based on detected language
	const homeLink = document.getElementById('back-home-link');
	if (detectedLang !== DEFAULT_LOCALE) {
		homeLink.href = '/' + detectedLang + '/';
	}
	
	// Update text if translation exists
	if (translations[detectedLang]) {
		document.getElementById('not-found-title').textContent = translations[detectedLang].notFoundTitle;
		document.getElementById('back-home-text').textContent = translations[detectedLang].backToHome;
	}
</script>